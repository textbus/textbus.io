<h1>Scheduler 调度器</h1>
<p>Scheduler 用于兼听文档变化，并自动触发渲染，并提供协作及历史记录管理事务相关的能力。</p>
<p style="background-color:rgb(255, 255, 255)"><span style="color:rgb(73, 80, 96)">通过编辑器实例或通过 useContext 勾子获取&nbsp;<span style="background-color:rgb(255, 255, 255)">Scheduler</span>&nbsp;的实例。</span></p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 方法1</span></div><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;scheduler = textbus.<span class="tb-hl-function">get</span>(Scheduler)</div><div class="tb-code-line"><span class="tb-hl-comment">// 方法2</span></div><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;yourComponent =&nbsp;<span class="tb-hl-function">defineComponent</span>({</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-function">setup</span>() {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-keyword">const</span>&nbsp;scheduler =&nbsp;<span class="tb-hl-function">useContext</span>(Scheduler)</div><div class="tb-code-line">&nbsp;&nbsp;}</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>lastChangesHasLocalUpdate 是否有本地变更</h2>
<p>一个变更周期内，是否包含本地变更。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line">lastChangesHasLocalUpdate:&nbsp;<span class="tb-hl-builtin">boolean</span></div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>lastChangesHasRemoteUpdate 是否有远程变更</h2>
<p style="background-color:rgb(255, 255, 255)"><span style="color:rgb(73, 80, 96)">一个变更周期内，是否包含远程变更（通常指协作引起的变更）。</span></p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line">lastChangesHasRemoteUpdate:&nbsp;<span class="tb-hl-builtin">boolean</span></div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>onDocChange 监听文档变化</h2>
<p>当文档发生变更时触发，直到文档文档渲染完成后文档再次产生变更时，继续触发。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line">onDocChange: Observable&lt;<span class="tb-hl-keyword">void</span>&gt;;</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<p>示例：</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line">scheduler.onDocChange.<span class="tb-hl-function">subscribe</span>(() =&gt; {</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(<span class="tb-hl-string">'文档发生变更了'</span>)</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>onDocChanged 监听视图同步完成</h2>
<p>文档变更并渲染完成后触发，ChangeItem 为变更的变更源和原子命令。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line">onDocChanged: Observable&lt;ChangeItem[]&gt;;</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<p>示例：</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line">scheduler.onDocChanged.<span class="tb-hl-function">subscribe</span>(changes =&gt; {</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-builtin">console</span>.<span class="tb-hl-function">log</span>(changes)</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>remoteUpdateTransact() 远程变更事务</h2>
<p>用于收集远程数据更新原子命令。task 为引起数据变更的回调函数。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line"><span class="tb-hl-function">remoteUpdateTransact</span>(task: () =&gt;&nbsp;<span class="tb-hl-keyword">void</span>):&nbsp;<span class="tb-hl-keyword">void</span>;</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<p>示例：</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line">scheduler.<span class="tb-hl-function">remoteUpdateTransact</span>(() =&gt; {</div><div class="tb-code-line">&nbsp;&nbsp;slot.<span class="tb-hl-function">insert</span>(<span class="tb-hl-string">'你好，'</span>)</div><div class="tb-code-line">&nbsp;&nbsp;slot.<span class="tb-hl-function">insert</span>(<span class="tb-hl-string">'Textbus!'</span>)</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>historyApplyTranscat() 历史记录变更事务</h2>
<p>用于收集历史记录引起的数据更新原子命令，task 为引起数据变更的回调函数。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line"><span class="tb-hl-function">historyApplyTransact</span>(task: () =&gt;&nbsp;<span class="tb-hl-keyword">void</span>):&nbsp;<span class="tb-hl-keyword">void</span>;</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<p style="background-color:rgb(255, 255, 255)"><span style="color:rgb(73, 80, 96)">示例：</span></p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line">scheduler.<span class="tb-hl-function">historyApplyTransact</span>(() =&gt; {</div><div class="tb-code-line">&nbsp;&nbsp;history.<span class="tb-hl-function">back</span>()</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>run() 启动调度器</h2>
<p>无需手动调用。Textbus 会在启动时自动调用。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line"><span class="tb-hl-function">run</span>():&nbsp;<span class="tb-hl-keyword">void</span></div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>destroy() 销毁调度器</h2>
<p>无需手动调用。Textbus 会在销毁时自动调用。</p><pre lang="TypeScript" theme="dark" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">// 类型签名：</span></div><div class="tb-code-line"><span class="tb-hl-function">destroy</span>():&nbsp;<span class="tb-hl-keyword">void</span></div></div><span class="tb-pre-lang">TypeScript</span></div></pre>