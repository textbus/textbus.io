<div class="xnote-root">
  <div data-placeholder="" class="xnote-content">
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h1">组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>什么是 Textbus 的组件？</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p><strong style="color:rgb(58, 170, 250)">Textbus 组件是一个无关视图的数据模型</strong>。我们应当都使用过现代前端框架，如 React、Vue、Angular 等，组件带给我们良好的封装、丰富的功能、易于维护和扩展的开发体验。使用 Textbus 开发富文本组件，也可以像前端框架一样，只需要掌握少量的 API 以及生命周期等，即可开发出令人惊叹的富文本组件。当然，Textbus 的组件也有自己的特有的功能，如自动记录操作历史，支持插槽编辑等，不过，你基本无需关心这些，因为 Textbus 的内核已经帮你做好了。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>一个最简单的 Textbus 组件结构如下：</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">Component</span>,&nbsp;<span class="hljs-title class_">ContentType</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_ inherited__">Component</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'RootComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>定义一个 Textbus 组件只需要继承&nbsp;<code class="xnote-code">Component</code>&nbsp;类，并定义组件名、组件类型和 fromJSON 的静态属性和方法即可。Textbus 不关心你将如何渲染这个组件，也就是说，你可以用任意的方式和 DOM 结构渲染 Textbus 的组件。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">如何渲染组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>Textbus 官方提供了&nbsp;<a href="https://viewfly.org/" target="_blank">Viewfly</a>、Vue 和 React 的渲染接入方式。你也可以使用其它方式渲染，只需要开发对应的视图适配器即可。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们以 Viewfly 为例，当我们定义好 Textbus 的组件后，还需要定义一个与之对应的视图组件，并在适配器中关联它们。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewflyAdapter</span>,&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/adapter-viewfly'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title function_">YourComponentView</span>(<span class="hljs-params">props: ViewComponentProps&lt;YourComponent&gt;</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&gt;</span>....<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;adapter =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">ViewflyAdapter</span>({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-comment">// 视图组件必须使用和 Textbus 组件相同的名字</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[<span class="hljs-title class_">YourComponent</span>.<span class="hljs-property">componentName</span>]:&nbsp;<span class="hljs-title class_">YourComponentView</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">视图组件 Props</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>每一个视图组件都会接收到一个由 Textbus 传入的 Props。Props 结构如下：</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&lt;T&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_">Component</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">component</span>: T</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">rootRef</span>:&nbsp;<span class="hljs-title class_">DynamicRef</span>&lt;<span class="hljs-title class_">HTMLElement</span>&gt;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>其中，component 为当前视图组件要渲染的 Textbus 组件实例（与适配器的的配置一一对应），rootRef 为组件根节点的 ref，<strong style="color:rgb(246, 48, 48)">你必须要把此 ref 实例添加到根节点的属性中</strong>，否则 Textbus 将无法区分原生 DOM 节点和组件的映射关系，导致不可预期的问题。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">动态组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>如前面示例，我们创建的组件只有一个名字和类型，这种组件我们可以把它叫做静态组件，静态组件适用于一些数据不会产生变化的场景，如一张图片，一个视频等。而大多数情况，我们更需要一个动态组件。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>动态组件可以帮助我们实现数据的更改和变化，在 Textbus 的动态组件中，我们不仅可以改变组件的状态，还可以使用插槽让组件内的一部分内容变成可编辑内容。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">创建动态组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>要创建动态组件，我们只需要在组件初始化时，传入我们想要的数据，并在渲染时，根据传入的数据渲染即可。我们还是以前面的组件为例：</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="false" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root.component.ts</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">Component</span>,&nbsp;<span class="hljs-title class_">ContentType</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">RootComponentState</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-built_in">string</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;classexport&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_">Component</span>&lt;<span class="hljs-title class_">RootComponentState</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'RootComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus, state: RootComponentState</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, state)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root-component.view.tsx</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/adapter-viewfly'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./root.component'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// 创建 RootComponentView 组件用于渲染 Textbus 根组件</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">const</span>&nbsp;<span class="hljs-title function_">RootComponentView</span>&nbsp;= (<span class="hljs-params">props: ViewComponentProps&lt;RootComponent&gt;</span>) =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&nbsp;<span class="hljs-attr">style</span>=<span class="hljs-string">{{color:</span>&nbsp;<span class="hljs-attr">props.component.state.color</span>}}&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这是 Textbus 富文本编辑器，我是 {props.component.name} 组件！</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="language-xml">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;rootModel =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-string">'red'</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">textbus.<span class="hljs-title function_">render</span>(rootModel)</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们在创建 RootComponent 实例时，通过 state 属性传入了一个配置对象，该对象会作为组件的状态保存在 RootComponent 实例中。在渲染时，我们读取了当前组件的 state.color 属性，并赋值给了 div 元素的 style 属性。这样，RootComponent 就有了动态数据的能力。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>你可以传入任意的可序列化的数据作为组件的状态以满足不同的需求！</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">组件状态管理</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们不仅可以在一个组件创建时传入 state，还可以对已有 state 的组件进行状态更改。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">const</span>&nbsp;<span class="hljs-title function_">RootComponentView</span>&nbsp;= (<span class="hljs-params">props: ViewComponentProps&lt;RootComponent&gt;</span>) =&gt; {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">function</span>&nbsp;<span class="hljs-title function_">toGreen</span>(<span class="hljs-params"></span>) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;props.<span class="hljs-property">component</span>.<span class="hljs-property">state</span>.<span class="hljs-property">color</span>&nbsp;=&nbsp;<span class="hljs-string">'green'</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&nbsp;<span class="hljs-attr">onClick</span>=<span class="hljs-string">{toGreen}</span>&nbsp;<span class="hljs-attr">style</span>=<span class="hljs-string">{{color:</span>&nbsp;<span class="hljs-attr">props.component.state.color</span>}}&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这是 Textbus 富文本编辑器，我是 {props.component.name} 组件！</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="language-xml">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在上面的示例中，当我们点击 div 时，更改了组件状态的 color 值。</p>
    </div>
    <blockquote data-component="BlockquoteComponent" class="xnote-blockquote">
      <div>
        <div data-component="ParagraphComponent" class="xnote-paragraph">
          <p>Textbus 仅支持数组、js 普通对象、js 普通字面量和插槽的状态管理。请不要将函数或其它不必要的大对象用于 Textbus 组件的状态中，如果这些对象中包含不可序列化的数据，将不能正常回退和在线协作。</p>
        </div>
      </div>
    </blockquote>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">可编辑组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>前面文档中的组件只是承担了状态管理的作用，我们只能更改其状态，并渲染在文档中。但富文本最核心的编辑能力，则需要借助插槽才能完成。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在 Textbus 组件中，我们可以给一个组件添加一个或多个插槽。插槽的作用类似于我们给一个 DOM 元素添加了 contenteditable="true" 一样，我们可以对插槽中的内容进行编辑、修改，还可以通过历史记录回退我们编辑的内容。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">插槽</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>什么是插槽？</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>插槽在 Textbus 中表示一段可编辑的文档，就像我们给一个 DIV 元素添加了 contenteditable="true" 一样。不同的是，Textbus 中的插槽的编辑行为完全由我们控制，而浏览器原生的 contenteditable 的行为是不可控的。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>要让组件支持插槽，只需要在组件创建时，在配置项传入一个插槽实例即可。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="false" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root.component.ts</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">Component</span>,&nbsp;<span class="hljs-title class_">ContentType</span>,&nbsp;<span class="hljs-title class_">Slot</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">RootComponentState</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-built_in">string</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-title class_">Slot</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;classexport&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_">Component</span>&lt;<span class="hljs-title class_">RootComponentState</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'RootComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus, state: RootComponentState</span>) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;registry = textbus.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Registry</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot = registry.<span class="hljs-title function_">createSlot</span>(state.<span class="hljs-property">slot</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">color</span>: state.<span class="hljs-property">color</span>,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-lang="Tsx" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root-component.view.tsx</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ createVNode }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">DomAdapter</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/platform-browser'</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ inject }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@viewfly/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/adapter-viewfly'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./root.component</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">// 创建 RootComponentView 组件用于渲染 Textbus 根组件</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">const RootComponentView = (props: ViewComponentProps&lt;RootComponent&gt;) =&gt; {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;// 获取视图适配器，用于渲染插槽</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;const adapter = inject(DomAdapter)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;return () =&gt; {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;// 由于我们在上面只给 rootComponent 组件提供了一个插槽，这里获取根组件的第一个插槽即可</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;const slot = props.component.state.slot</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;return &lt;div ref={props.rootRef}&gt;</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;这是 Textbus 富文本编辑器，我是 {props.component.name} 组件！&lt;/div&gt;</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 通过适配器的 slotRender 方法，渲染插槽的内容</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.slotRender(slot, children =&gt; {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 使用 Textbus 内置的 createVNode 方法，渲染插槽的根节点 p</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-string">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return createVNode('</span>div<span class="hljs-string">', null, children)</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">Tsx/Jsx</span>
      </div>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;rootModel =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-string">'red'</span>,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">Slot</span>([</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">Text</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;])</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">textbus.<span class="hljs-title function_">render</span>(rootModel)</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们再次运行项目，如无意外，你会在页面中看到一个可编辑的 div 标签了。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">子组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>目前，我们实现的编辑器只能支持文本输入，而正常的文档往往是由多个段落组成，要实现多段落功能，我们还需要再编写一个段落组件。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="false" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # paragraph.component.ts</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">ParagraphComponentState</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-title class_">Slot</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title class_">ParagraphComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_ inherited__">Component</span>&lt;<span class="hljs-title class_">ParagraphComponentState</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'ParagraphComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus, state: RootComponentState</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;registry = textbus.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Registry</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot = registry.<span class="hljs-title function_">createSlot</span>(state.<span class="hljs-property">slot</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-lang="Tsx" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # paragraph-component.view.tsx</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ createVNode }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/adapter-viewfly'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">DomAdapter</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/platform-browser'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ inject }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@viewfly/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ParagraphComponent</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./paragraph.component'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">const</span>&nbsp;<span class="hljs-title class_">ParagraphComponentView</span>&nbsp;= (<span class="hljs-attr">props</span>:&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&lt;<span class="hljs-title class_">ParagraphComponent</span>&gt;) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;adapter =&nbsp;<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">DomAdapter</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">data-component</span>=<span class="hljs-string">{props.component.name}</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.slotRender(props.component.state.slot, children =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return createVNode('p', null, children)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="language-xml">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">Tsx/Jsx</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>将我们的段落组件注册到视图适配器。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # editor.ts</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ParagraphComponent</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./paragraph.component'</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ParagraphComponentView</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./paragraph-component.view'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;adapter =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">ViewflyAdapter</span>({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[<span class="hljs-title class_">RootComponent</span>.<span class="hljs-property">componentName</span>]:&nbsp;<span class="hljs-title class_">RootComponentView</span>,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[<span class="hljs-title class_">ParagraphComponent</span>.<span class="hljs-property">componentName</span>]:&nbsp;<span class="hljs-title class_">ParagraphComponentView</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">},&nbsp;<span class="hljs-function">(<span class="hljs-params">host, root</span>) =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;...</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>一个文档往往都是从一个空文档开始，再根据用户的输入，生成段落、格式等等，为了尽量靠近真实环境，我们要对 RootComponent 做一些调整，把不需要的标签删除掉。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root-component.view.tsx</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;<span class="hljs-title function_">RootComponentView</span>&nbsp;= (<span class="hljs-params">props: ViewComponentProps&lt;RootComponent&gt;</span>) =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;adapter =&nbsp;<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">DomAdapter</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot = props.<span class="hljs-property">component</span>.<span class="hljs-property">state</span>.<span class="hljs-property">slot</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&nbsp;<span class="hljs-attr">data-component</span>=<span class="hljs-string">{props.component.name}</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 通过适配器的 slotRender 方法，渲染插槽的内容</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.slotRender(slot, children =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 使用 Textbus 内置的 createVNode 方法，渲染插槽的根节点 p</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return createVNode('div', null, children)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="language-xml">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>现在我们的 RootComponent 组件基本达到我们的要求了。启动项目，Textbus 会在浏览器中渲染出一个空的 RootComponent 组件，我们可以在中间输入文本、换行等。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在实际场景中，我们往往希望把这些文本全都插入在段落中，而不是直接写在根组件内。我们应当如何控制用户的输入并把文字输入到段落中呢？</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">组件事件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>为了让 RootComponent 组件的插槽可以插槽段落，我们需要先让它的插槽支持插入 Block 组件。更改 RootComponent 组件的初始化代码。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # editor.ts</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">const</span>&nbsp;rootModel =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-string">'red'</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">Slot</span>([</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">Text</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">InlineComponent</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;])</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">textbus.<span class="hljs-title function_">render</span>(rootModel)</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们的需求是，当用户在 RootComponent 组件的插槽内输入时，我们需要拦截用户的输入，并把输入的结果插入在一个新的段落内，同时还需要把光标也移动到段落内的文字后面。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在 Textbus 中，用户的所有输入、删除等操作都是可控的，我们可以监听相关事件，并定制其功能。要监听用户的输入内容事件，只需要在 Textbus 组件中调用 onContentInsert 勾子即可。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # root.component.ts</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">Component</span>,&nbsp;<span class="hljs-title class_">ContentType</span>,&nbsp;<span class="hljs-title class_">Slot</span>, useContext,&nbsp;<span class="hljs-title class_">Selection</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">RootComponentState</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">color</span>:&nbsp;<span class="hljs-built_in">string</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-title class_">Slot</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title class_">RootComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_ inherited__">Component</span>&lt;<span class="hljs-title class_">RootComponentState</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'RootComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus, state: RootComponentState</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;registry = textbus.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Registry</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot = registry.<span class="hljs-title function_">createSlot</span>(state.<span class="hljs-property">slot</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">color</span>: state.<span class="hljs-property">color</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;selection =&nbsp;<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Selection</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 监听内容插入事件</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title function_">onContentInsert</span>(<span class="hljs-function"><span class="hljs-params">ev</span>&nbsp;=&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 当插入的内容是一个字符串或行内组件时，我们将创建新的段落</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-keyword">typeof</span>&nbsp;ev.<span class="hljs-property">data</span>.<span class="hljs-property">content</span>&nbsp;===&nbsp;<span class="hljs-string">'string'</span>&nbsp;|| ev.<span class="hljs-property">data</span>.<span class="hljs-property">content</span>.<span class="hljs-property">type</span>&nbsp;!==&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span>) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 创建新的插槽，并把内容插入在新插槽内</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">Slot</span>([</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">Text</span>,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">InlineComponent</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot.<span class="hljs-title function_">insert</span>(ev.<span class="hljs-property">data</span>.<span class="hljs-property">content</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 创建新的段落组件，并把插槽传给段落组件</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;p =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">ParagraphComponent</span>(injector, {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 在 rootComponent 的插槽内插入新段落</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.<span class="hljs-property">target</span>.<span class="hljs-title function_">insert</span>(p)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 设置光标为段落组件插槽的索引位置</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection.<span class="hljs-title function_">setPosition</span>(slot, slot.<span class="hljs-property">index</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 阻止默认的插入事件</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.<span class="hljs-title function_">preventDefault</span>()</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>现在，当我们再在 RootComponent 组件内输入时，你将会发现我们输入的内容全都到段落里面了。但当我们在段落内换行内，我们发现此时的换行还如原来一样，只是增加了一个 br 标签。在大多数场景中，我们需要换行时开启一个新段落。让我们对段落的换行行为再做一些定制。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # paragraph.component.ts</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title class_">ParagraphComponentState</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">slot</span>:&nbsp;<span class="hljs-title class_">Slot</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title class_">ParagraphComponent</span>&nbsp;<span class="hljs-keyword">extends</span>&nbsp;<span class="hljs-title class_ inherited__">Component</span>&lt;<span class="hljs-title class_">ParagraphComponentState</span>&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;componentName =&nbsp;<span class="hljs-string">'ParagraphComponent'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">type</span>&nbsp;=&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-title function_">fromJSON</span>(<span class="hljs-params">textbus: Textbus, state: RootComponentState</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;registry = textbus.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Registry</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot = registry.<span class="hljs-title function_">createSlot</span>(state.<span class="hljs-property">slot</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">RootComponent</span>(textbus, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;self =&nbsp;<span class="hljs-title function_">useSelf</span>()</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;commander =&nbsp;<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Commander</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;selection =&nbsp;<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Selection</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 监听换行事件</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title function_">onBreak</span>(<span class="hljs-function"><span class="hljs-params">ev</span>&nbsp;=&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 剪切光标后的内容，并插入在新插槽内</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;afterContentDelta = ev.<span class="hljs-property">target</span>.<span class="hljs-title function_">cut</span>(ev.<span class="hljs-property">data</span>.<span class="hljs-property">index</span>).<span class="hljs-title function_">toDelta</span>()</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;slot =&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">Slot</span>([</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">Text</span>,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">InlineComponent</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slot.<span class="hljs-title function_">insertDelta</span>(afterContentDelta)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 创建新段落，并传入新插槽</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;nextParagraph = paragraphComponent.<span class="hljs-title function_">createInstance</span>(injector, {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">slots</span>: [slot]</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 把新段落插入在当前段落后</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commander.<span class="hljs-title function_">insertAfter</span>(nextParagraph, self)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 设置光标为新段落的开始</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection.<span class="hljs-title function_">setPosition</span>(slot,&nbsp;<span class="hljs-number">0</span>)</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// 阻止默认的折行行为</span></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.<span class="hljs-title function_">preventDefault</span>()</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>至此，当我们在 RootComponent 组件输入时，我们将创建一个新的段落，我们可以在段落内正常的输入。当我们在段落内换行时，可以开启一个新的段落。我们基础版的编辑器就算完成了。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">多插槽组件</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>前面我们创建的 RootComponent 和 ParagraphComponent 都是单插槽组件。我们还可以创建多插槽组件，如列表、表格等，我们以列表为例，一个 ul 下可能包含多个 li。</p>
    </div>
    <div data-lang="TypeScript" data-component="SourceCodeComponent" data-auto-break="true" data-theme="atom-one-dark" data-line-number="true" class="xnote-source-code xnote-source-code-line-number atom-one-dark">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-comment">// # list.component.ts</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ defineComponent,&nbsp;<span class="hljs-title class_">ContentType</span>,&nbsp;<span class="hljs-title class_">Selection</span>,&nbsp;<span class="hljs-title class_">Slot</span>, useContext, onBreak, createVNode }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/adapter-viewfly'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{&nbsp;<span class="hljs-title class_">ViewAdapter</span>&nbsp;}&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@textbus/platform-browser'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ inject }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'@viewfly/core'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">import</span>&nbsp;{ paragraphComponent }&nbsp;<span class="hljs-keyword">from</span>&nbsp;<span class="hljs-string">'./paragraph.component'</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">const</span>&nbsp;listComponent =&nbsp;<span class="hljs-title function_">defineComponent</span>({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">name</span>:&nbsp;<span class="hljs-string">'ListComponent'</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-attr">type</span>:&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">BlockComponent</span>,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;selection =&nbsp;<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Seletion</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-title function_">onBreak</span>(<span class="hljs-function"><span class="hljs-params">ev</span>&nbsp;=&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(ev.<span class="hljs-property">target</span>.<span class="hljs-property">isEmpty</span>&nbsp;&amp;&amp; ev.<span class="hljs-property">target</span>&nbsp;=== slots.<span class="hljs-property">last</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;paragraph = paragraphComponent.<span class="hljs-title function_">createInstance</span>(injector, {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">slots</span>: [</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span>&nbsp;<span class="hljs-title class_">Slot</span>([<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">Text</span>,&nbsp;<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">InlineComponent</span>])</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;parentComponent = selection.<span class="hljs-property">commonAncestorComponent</span>!</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;parentSlot = parentComponent.<span class="hljs-property">parent</span>!</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;index = parentSlot.<span class="hljs-title function_">indexOf</span>(parentComponent)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parentSlot.<span class="hljs-title function_">retain</span>(index +&nbsp;<span class="hljs-number">1</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(slots.<span class="hljs-property">length</span>&nbsp;&gt;&nbsp;<span class="hljs-number">1</span>) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots.<span class="hljs-title function_">remove</span>(slots.<span class="hljs-property">last</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parentSlot.<span class="hljs-title function_">insert</span>(paragraph)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection.<span class="hljs-title function_">setPosition</span>(paragraph.<span class="hljs-property">slots</span>.<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>)!,&nbsp;<span class="hljs-number">0</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.<span class="hljs-title function_">preventDefault</span>()</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;nextLi = ev.<span class="hljs-property">target</span>.<span class="hljs-title function_">cut</span>(ev.<span class="hljs-property">data</span>.<span class="hljs-property">index</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots.<span class="hljs-title function_">insertAfter</span>(nextLi, ev.<span class="hljs-property">target</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection.<span class="hljs-title function_">setPosition</span>(nextLi,&nbsp;<span class="hljs-number">0</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.<span class="hljs-title function_">preventDefault</span>()</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="hljs-keyword">export</span>&nbsp;<span class="hljs-keyword">const</span>&nbsp;<span class="hljs-title class_">ListComponentView</span>&nbsp;= (<span class="hljs-attr">props</span>:&nbsp;<span class="hljs-title class_">ViewComponentProps</span>&lt;<span class="hljs-keyword">typeof</span>&nbsp;listComponent&gt;) {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;adapter =&nbsp;<span class="hljs-title function_">inject</span>(<span class="hljs-title class_">ViewAdapter</span>)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-function">() =&gt;</span>&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span>&nbsp;component = props.<span class="hljs-property">component</span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;(</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&nbsp;<span class="hljs-attr">ref</span>=<span class="hljs-string">{props.rootRef}</span>&nbsp;<span class="hljs-attr">data-component</span>=<span class="hljs-string">{component.name}</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;component.slots.toArray().map(slot =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return adapter.slotRender(slot, children =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return createVNode('li', null, children)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><span class="language-xml">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang">TypeScript</span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们完成了 listComponent 的开发，并且，当我们在列表内换行时，如果是末尾有连续两个 li，将跳出列表，并创建一个新的段落。现在，我们把 listComponent 添加到适配器中。</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">// # editor.ts</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">import { listComponent, ListComponentView } from './list.component'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">const adapter = new Adapter({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[rootComponent.name]: RootComponentView,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[paragraphComponent.name]: ParagraphComponentView,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;[listComponent.name]: ListComponentView</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}, (host, root) =&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;...</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们可以先忽略 listComponent 组件的实现细节，可以等学习了后面组件更多的使用细节再回头来看。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">Markdown 语法支持</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们前面创建了 listComponent 组件，但目前我们没有任何方法可以在文档中插入一个 listComponent 组件实例。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>Textbus 支持在组件配置项中直接声明语法转换配置。我们可以定义任意的语法转换实现，这里我们以 Markdown 语法转换为列表为例：</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">// # list.component.ts</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { defineComponent, ContentType, Selection, Slot, useContext, onBreak, createVNode } from '@textbus/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewComponentProps } from '@textbus/adapter-viewfly'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewAdapter } from '@textbus/platform-browser'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { inject } from '@viewfly/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { paragraphComponent } from './paragraph.component'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">export const listComponent = defineComponent({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;name: 'ListComponent',</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;type: ContentType.BlockComponent,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;// 添加 zenCoding 配置，Textbus 会在语法匹配时，自动转换为我们的组件</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;zenCoding: {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;key: ' ', // 输入空格时触发转换</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;match: /^([+*])$/, // 只有在一个空段落开头，且第一个字符中 + 号或 * 号时，才可以转换</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;generateInitData() {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// 当匹配成功时，创建一个空组件数据并返回，Textbus 会把返回的数据传给当前生成的组件</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots: [</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Slot([</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.Text,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentType.InlineComponent</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;},</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;setup() {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;...</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>不要忘了在 Textbus 的配置项中开启 zenCoding。</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">// 创建 Textbus 实例</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">const textbus = new Textbus({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;imports: [</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;browserModule // 添加浏览器支持模块</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;],</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;zenCoding: true</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>现在，当我们在文档的空白段落输入 + 号或 * 号并按空格时，便可实时转换为一个列表组件并插入在文档中。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">组件扩展方法</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>当我们的组件需要给外部提供数据时，我们可以在 setup 方法内返回任意值给外部使用。我们以列表组件为例，当外部要获取当前组件有多少个列表项时，我们可以对外提供一个 getListCount 方法。</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">/ # list.component.ts</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { defineComponent, ContentType, Selection, Slot, useContext, onBreak, createVNode, useSelf } from '@textbus/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewComponentProps } from '@textbus/adapter-viewfly'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewAdapter } from '@textbus/platform-browser'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { inject } from '@viewfly/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { paragraphComponent } from './paragraph.component'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">export const listComponent = defineComponent({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;name: 'ListComponent',</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;type: ContentType.BlockComponent,</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;...</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;setup() {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;const self = useSelf()</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;return {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getListCount() {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return self.slots.length</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">const listComponentInstance = listComponent.createInstance(textbus, {...})</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">// 通过组件实例的 extends 获取 setup 方法的返回值</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">const count = listComponentInstance.extends.getListCount()</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">组件数据校验</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在前面的组件示例中，我们无一例外的向组件传入了插槽，在实例化这些插槽时，我们传入了 ContentType.Text 或 ContentType.InlineComponent 等配置，为插槽可插入内容做出了限制，但在实际的场景中，这些插槽的数据可能会传错，或者有缺失，也有可能传多了，比如，给段落组件传入了两个及以上插槽。这将引起不可预期的 bug。我们可以在组件配置选项中，对这些数据进行校验，以确保组件数据的正确性。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们以段落组件的校验为例：</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content xnote-source-code-content-highlight"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">// # paragraph.component.tsx</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { defineComponent, ContentType, createVNode, onBreak, Slot, Seletion, useSelf, Commander, ComponentInitData, Textbus } from '@textbus/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewComponentProps } from '@textbus/adapter-viewfly'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { ViewAdapter } from '@textbus/platform-browser'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { inject } from '@viewfly/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">export const paragraphComponent = defineComponent({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;name: 'ParagraphComponent',</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;type: ContentType.BlockComponent,</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;validate(textbus: Textbus, initData?: ComponentInitData) {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;return {</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots: [initData?.slots?.[0] || new Slot([ContentType.Text, ContentType.InlineComponent])]</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line xnote-source-code-line-emphasize"><span class="xnote-source-code-line-content">&nbsp;&nbsp;},</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;setup() {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;...</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们对段落组件的初始数据进行了基本的验证，当初始数据的插槽配置项内有插槽时，我们只使用第一个插槽。如果没有，则创建一个插槽，确保数据的正确。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>如果有必要，我们还可以根据做进一步的更详细校验。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">插槽集</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>一个组件可以没有插槽，也可以有任意多个插槽，我们可以根据自己的需要增加或删除插槽。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>获取组件的插槽只需要在 setup 函数内，调用获取组件的实例，然后访问当前组件的插槽即可。</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">import { defineComponent, useSelf } from '@textbus/core'</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">const component = defineComponent({</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;setup() {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;const self = useSelf() // 获取当前组件实例</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content"><br></span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;console.log(self.slots)</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;}</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">})</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>我们可以根据需要调用 slots 的 insert()、delete() 等方法，对插槽进行增加或修改。更多方法请参考 API 下 slots 相关文档。&nbsp;</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h2">组件选项</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>在前面的文档中，我们已经创建了各种常见形态的组件，</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p><span style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">你当然可以</span></p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>可以根据自己的需要，创建更多的组件。但要更清晰的了解 Textbus 的组件，我们还需要详细了解创建组件时的配置项。</p>
    </div>
    <div data-lang="" data-component="SourceCodeComponent" data-auto-break="true" data-theme="null" data-line-number="true" class="xnote-source-code xnote-source-code-line-number null">
      <div class="xnote-source-code-container hljs xnote-source-code-auto-break">
        <div style="width:2.5em" class="xnote-source-code-line-number-bg"></div>
        <div style="padding-left:2.5em;margin-left:-2.5em" class="xnote-source-code-content"><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">/**</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;* Textbus 扩展组件接口</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;*/</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">export interface ComponentOptions&lt;State, SlotState, Extends&gt; {</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/** 组件名 */</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;name: string;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/** 组件类型 */</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;type: ContentType;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/** 组件是否可拆分 */</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;separable?: boolean;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/** 输入语法糖支持 */</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;zenCoding?: ZenCodingGrammarInterceptor&lt;ComponentInitData&lt;State, SlotState&gt;&gt; | ZenCodingGrammarInterceptor&lt;ComponentInitData&lt;State, SlotState&gt;&gt;[];</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/**</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* 组件初始数据校验</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* @param context</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* @param initData</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;validate?(context: Textbus, initData?: ComponentInitData&lt;State, SlotState&gt;): ComponentInitData&lt;State, SlotState&gt;;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;/**</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* 组件初始化实现</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">&nbsp;&nbsp;&nbsp;&nbsp;setup?(): Extends;</span></pre><pre class="xnote-source-code-line"><span class="xnote-source-code-line-content">}</span></pre>
        </div><span class="xnote-source-code-lang"></span>
      </div>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p><span style="color:rgb(73, 80, 96)">组件名字 name</span></p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p><span style="color:rgb(73, 80, 96)">一个字符串，组件的名字，在一个 Textbus 实例中，它<strong>必须是唯一</strong>的。Textbus 在查找和储存历史记录时，都会用到它。</span></p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">组件类型 type</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>组件类型。在 Textbus 的数据定义中，共有三种数据类型，它们分别是：</p>
    </div>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>块组件</strong>：ContentType.BlockComponent</div>
      </li>
    </ul>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>行内组件</strong>：Component.InlineComponent</div>
      </li>
    </ul>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>文本</strong>：ContentType.Text</div>
      </li>
    </ul>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>需要注意的是，这里定义的块组件和行内组件，在展示上并不总是和 HTML 是一样的，它只是 Textbus 用于计算格式变换和结构变换的依据。事实上，你完全可以定义一个块组件，但让它显示效果像一个行内组件，亦或是相反。不过，我们还是建议你在定义组件类型的时候，尽量和展示效果保持一致。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">是否可拆分 separable</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>布尔值，默认为 false，表示一个组件是否可以拆分。Textbus 在做格式变换时，会根据些项配置决定是否拆分当前组件。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>如列表组件（ul，ol），可把某一个子插槽变更为段落，也可拆分为两个列表组件。如果是这类型的组件，我们应该配置为 true。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>如表格组件，我们不可以把表格的某一个单元格插槽单独拿出来，则我们应该配置为 false</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">输入语法糖 zenCoding</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>通过配置一个或一组的语法规则，可以实现输入实时转换，如 Markdown 语法的支持。当你，你也可以完全自定义自己的语法规则。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>其中：</p>
    </div>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>match</strong>&nbsp;为一个正则表达式或是一个函数，用于匹配当前输入项是否满足语法条件</div>
      </li>
    </ul>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>key</strong>&nbsp;为触发 Textbus 转换的输入键值，如 Todolist 这里，我们以用户输入空格作为触为条件</div>
      </li>
    </ul>
    <ul data-component="ListComponent" style="margin-left:0px" class="xnote-list">
      <li>
        <div class="xnote-list-type"><span class="xnote-order-btn">•</span></div>
        <div class="xnote-list-content"><strong>generateInitData</strong>&nbsp;为一个函数，会把当前匹配到的文本内容传入。你可以根据传入的字符生成当前组件实例化时所需要的参数并返回</div>
      </li>
    </ul>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p><strong style="color:rgb(58, 170, 250)">提示</strong>：zenCoding 语法规则不仅限于 markdown。实际上，你可以定义任何你想要的语法，如：#table:row=3,col=4 转换为一个 3 行 4 列的表格。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">数据验证 validate()</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>组件数据校验方法，我们可以对外部输入的数据做校验，也可以提供默认数据给新创建的组件。</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p class="xnote-h3">组件设置 setup()</p>
    </div>
    <div data-component="ParagraphComponent" class="xnote-paragraph">
      <p>组件的核心方法。你可以在该方法内定义组件的行为、数据，也可以对外暴露数据和方法。</p>
    </div>
  </div>
</div>