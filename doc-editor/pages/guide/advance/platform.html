<h1>跨平台基础</h1>
<p>Textbus 内核是一个平台无关的富文本内核。如果你需要在 web 平台以外的运行环境中使用 Textbus，可参考以下方法，实现相应接口即可。</p>
<p>原生选区必须要实现的接口：</p><pre lang="TypeScript" theme="starry" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;* 用于跨平台实现的原生选区抽象类</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;*/</span></div><div class="tb-code-line"><span class="tb-hl-keyword">export</span>&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-keyword">class</span>&nbsp;<span class="tb-hl-class-name">NativeSelectionBridge</span>&nbsp;{</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* 连接方法，Textbus 在需要桥接原生选区时调用，并传入连接器</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* @param connector</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;*/</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">connect</span>(connector: NativeSelectionConnector):&nbsp;<span class="tb-hl-keyword">void</span></div><div class="tb-code-line"><br></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* 取消连接方法，Textbus 会在不需要桥接选区时调用</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;*/</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">disConnect</span>():&nbsp;<span class="tb-hl-keyword">void</span></div><div class="tb-code-line"><br></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* Textbus 选区变化时调用，同时传入选区位置，用于原生选区实现具体平台的拖蓝效果</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* @param range</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* @param changeFromLocal 是否是本地引起的变化</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;*/</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">restore</span>(range: AbstractSelection |&nbsp;<span class="tb-hl-keyword">null</span>, changeFromLocal:&nbsp;<span class="tb-hl-builtin">boolean</span>):&nbsp;<span class="tb-hl-keyword">void</span></div><div class="tb-code-line"><br></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* 获取上一行光标位置</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* @param position</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;*/</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">getPreviousLinePositionByCurrent</span>(position: SelectionPosition): SelectionPosition |&nbsp;<span class="tb-hl-keyword">null</span></div><div class="tb-code-line"><br></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* 获取下一行光标位置</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;* @param position</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;&nbsp;&nbsp;*/</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">getNextLinePositionByCurrent</span>(position: SelectionPosition): SelectionPosition |&nbsp;<span class="tb-hl-keyword">null</span></div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<p>原生平台必须要实现的视图适配器：</p><pre lang="TypeScript" theme="starry" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-comment">/**</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;* Textbus 渲染适配器</span></div><div class="tb-code-line"><span class="tb-hl-comment">&nbsp;*/</span></div><div class="tb-code-line"><span class="tb-hl-keyword">export</span>&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-keyword">class</span>&nbsp;<span class="tb-hl-class-name">ViewAdapter</span>&nbsp;{</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/** 当视图更新时触发事件的可观察对象，用于通知 Textbus 视图渲染已完成 */</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;onViewUpdated: Observable&lt;<span class="tb-hl-keyword">void</span>&gt;</div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/** 当前平台的复制能力 */</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">copy</span>():&nbsp;<span class="tb-hl-keyword">void</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-comment">/** 根组件渲染方法 */</span></div><div class="tb-code-line">&nbsp;&nbsp;<span class="tb-hl-keyword">abstract</span>&nbsp;<span class="tb-hl-function">render</span>(rootComponent: ComponentInstance): (<span class="tb-hl-keyword">void</span>&nbsp;| (() =&gt;&nbsp;<span class="tb-hl-keyword">void</span>))</div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>
<h2>提供适配器</h2>
<p>在实现了如上接口后，你可以 Textbus 初始化时，通过 providers 配置，把你实现的适配器提供给 Textbus 即可。</p><pre lang="TypeScript" theme="starry" line-number class="tb-pre"><div class="tb-pre-content"><div style="width:2.5em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;textbus =&nbsp;<span class="tb-hl-keyword">new</span>&nbsp;<span class="tb-hl-class-name">Textbus</span>({</div><div class="tb-code-line">&nbsp;&nbsp;providers: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;provide: NativeSelectionBridge,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;useVlaue: yourSelectionBridge</div><div class="tb-code-line">&nbsp;&nbsp;}, {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;provide: ViewAdapter,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;useValue: yourAdapter</div><div class="tb-code-line">&nbsp;&nbsp;}]</div><div class="tb-code-line">})</div></div><span class="tb-pre-lang">TypeScript</span></div></pre>