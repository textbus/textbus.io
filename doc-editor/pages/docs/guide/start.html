<h1>引言</h1>
<p>从本节开始，你将真正踏入 Textbus 开发的门槛，整个深入的文档，可能需要你花费一个小时来阅读，相信你一定会有所收获。在阅读时，你可以不用太过注重细节，等遇到问题时，再来重新查阅。</p>
<p>在进入具体文档之前，我们需要先了解一些 Textbus 中的基本概念，这不会很多，但这都是 Textbus 中最核心的要素，它将有助于你更轻松的做出自己想要的功能。需要注意的是，Textbus 和其它的富文本dfdsa编辑器不同，<strong style="color:rgb(18, 150, 219)">Textbus 没有内置任何功能</strong>，你在官网看到的编辑器，实际上是我们在内核的基础上扩展而来的。如果你创建一个没有任何配置项的编辑器，你将只会得到一个有文字编辑功能输入框，就像 textarea 一样<span style="color:rgb(128, 132, 143)">（实际功能可能根据根组件的不同而不同，因为根组件是必须的）</span>。</p>
<p>深入文档主要是示例为主，可能有涵盖不全的地方，由于篇幅限制，很难在这里完全列举完，你可以查阅&nbsp;<a target="_blank" href="/api">API</a>&nbsp;下的文档，不过，现在我们还是先停留在这里。</p>
<h2>数据结构</h2>
<p>所有的现代编辑器都会有自己的数据模型，并且大多数都采用 JSON 来描述。Textbus 的数据也可以用 JSON 来描述，一个基本的数据可能如下：</p><pre theme="dark" lang="TypeScript" class="tb-pre"><div style="width:2em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;json = {</div><div class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'MyComponent'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;slots: []</div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></pre>
<p>是的，你没看错，这就是 Textbus 最基本的数据结构。上面的数据表示一个名字为 MyComponent 的组件。至于这个组件会渲染成什么样，Textbus 并不知道，而是由组件的 render 方法返回的虚拟 DOM 实现的。</p>
<p>同时，我们看到组件有 slots 属性，即组件的子插槽集合。插槽的数据结构如下：</p><pre theme="dark" lang="TypeScript" class="tb-pre"><div style="width:2em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;json = {</div><div class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'MyComponent'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;slots: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 这里是插槽的数据</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;schema: [<span class="tb-hl-number">0</span>,&nbsp;<span class="tb-hl-number">1</span>,&nbsp;<span class="tb-hl-number">2</span>],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;content: [<span class="tb-hl-string">'我是插槽的内容'</span>],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;formats: {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bold: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">0</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">7</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span class="tb-hl-boolean">true</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="tb-code-line">&nbsp;&nbsp;}]</div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></pre>
<p>插槽也可以包含多个格式</p><pre theme="dark" lang="TypeScript" class="tb-pre"><div style="width:2em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;json = {</div><div class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'MyComponent'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;slots: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 这里是插槽的数据</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;schema: [<span class="tb-hl-number">0</span>,&nbsp;<span class="tb-hl-number">1</span>,&nbsp;<span class="tb-hl-number">2</span>],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;content: [<span class="tb-hl-string">'我是插槽的内容'</span>],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 格式数据</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;formats: {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bold: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">0</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">7</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span class="tb-hl-boolean">true</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fontSize: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">0</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">1</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span class="tb-hl-string">'12px'</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">4</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">6</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span class="tb-hl-string">'18px'</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">0</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">5</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value: {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href:&nbsp;<span class="tb-hl-string">'https://textbus.io'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target:&nbsp;<span class="tb-hl-string">'_blank'</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="tb-code-line">&nbsp;&nbsp;}]</div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></pre>
<p>插槽也可以包含子组件</p><pre theme="dark" lang="TypeScript" class="tb-pre"><div style="width:2em" class="tb-code-line-number-bg"></div><div class="tb-code-content"><div class="tb-code-line"><span class="tb-hl-keyword">const</span>&nbsp;json = {</div><div class="tb-code-line">&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'MyComponent'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;slots: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 这里是子插槽的数据</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;schema: [<span class="tb-hl-number">0</span>,&nbsp;<span class="tb-hl-number">1</span>,&nbsp;<span class="tb-hl-number">2</span>],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;content: [</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-string">'我是插槽的内容'</span>, {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tb-hl-comment">// 这里是子组件</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;<span class="tb-hl-string">'ChildComponent'</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state:&nbsp;<span class="tb-hl-keyword">null</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slots: []</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;],</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;formats: {</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bold: [{</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startIndex:&nbsp;<span class="tb-hl-number">0</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endIndex:&nbsp;<span class="tb-hl-number">7</span>,</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value:&nbsp;<span class="tb-hl-boolean">true</span></div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]</div><div class="tb-code-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="tb-code-line">&nbsp;&nbsp;}]</div><div class="tb-code-line">}</div></div><span class="tb-pre-lang">TypeScript</span></pre>
<h2>数据转换</h2>
<p>虽然 Textbus 支持以 JSON 作为数据输入/输出，但直接操作 JSON 无疑是一件非常麻烦和容易出错的事。所以 Textbus 会把输入的 JSON 转换为内部的组件或插槽的实例。</p>
<p>你可以通过&nbsp;<a target="_blank" href="https://textbus.io/api/core#Translator-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E5%99%A8">Translator</a>&nbsp;来转换数据。 translator 会把输入的 JSON 转换为如下几个数据模型类的实例。</p>
<h3 style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">格式 Formatter</h3>
<p style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">格式是用于对文档内的文本进行装饰、美化或补充的一种数据，如加粗、文字颜色、对方方式等，格式可以通过选区动态的设置生效的范围，且不会更改文档的数据结构。</p>
<h3 style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">插槽 Slot</h3>
<p style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">插槽表示一段可编辑的文档。就像我们在 div 标签上开启了 contenteditable="true" 一样，我们可以在插槽内添加文字、图片、表格、视频等，也可以给插槽内的文字添加格式。</p>
<h3 style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">组件 Component</h3>
<p style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">组件在 Textbus 中为一段固定或特定结构的文档。除了文字以外，所有的内容都是由组件组成的。我们还可以在组件上监听事件、添加交互、执行特定的生命周期函数等，以支持更丰富的富文本效果。</p>
<h3 style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">插槽集 Slots</h3>
<p style="background-color:rgb(255, 255, 255);color:rgb(73, 80, 96)">插槽集是表示组件内插槽的集合，一个组件可以没有插槽，也可以有多个插槽。这些子插槽，都将由 Slots 来管理。</p>
<p><br></p>